---
name: spyn-yaml-export
description: >
  Handles YAML export, project save/load, and the Claude Code handoff workflow
  for the Spyn 3D scroll choreography tool. The YAML spec (spyn.config.yaml) is
  Spyn's primary output — it must be precise enough for Claude Code to implement
  scroll animations without ambiguity. Use when exporting YAML, validating export
  output, saving/loading projects, implementing copy-to-clipboard, or refining
  the export schema. Triggers on "export YAML", "generate config", "spyn.config",
  "save project", "load project", "handoff to Claude Code", "copy config",
  "download YAML", or any work related to Spyn's output format. Make sure to use
  this skill whenever touching the export pipeline — the YAML spec is the product.
---

# Spyn YAML Export

## Why This Matters

The YAML export is the entire point of Spyn. It bridges designer intent and AI
implementation. Every field must be:
- **Unambiguous** — Claude Code should never need to guess what a value means
- **Complete** — all information needed to build the scroll animation
- **Consistent** — snake_case naming, degrees not radians, vw/vh not pixels

## YAML Schema

### Full Output Structure
```yaml
# spyn.config.yaml — Generated by Spyn
# Project: [project name]
# Exported: [ISO timestamp]

project: "My Landing Page"

model:
  file: "model.glb"
  initial_scale: 1.0
  initial_rotation:
    x: 0
    y: 0
    z: 0

physics:
  momentum: true
  drag: 0.3
  overshoot: 0.1

sections:
  - id: "spyn-1-abc123"
    type: "hero-banner"
    label: "Hero Banner"
    height_vh: 100
    content_blocks:
      - id: "spyn-2-def456"
        type: "heading"
        label: "Main Heading"
        position:
          x: 10    # vw from left
          y: 30    # vh from section top
          w: 45    # width in vw
          h: 10    # height in vh
        z_layer: 0

keyframes:
  - scroll: 0.0
    section: "spyn-1-abc123"
    description: "Model centered in hero, slightly elevated"
    model:
      position:
        x: 50    # vw (0=left, 100=right, 50=center)
        y: 50    # vh (0=top, 100=bottom, 50=center)
        z: 2     # depth (positive=in front of content, negative=behind)
      rotation:
        x: 0     # degrees
        y: 0     # degrees
        z: 0     # degrees
      scale: 1.0
      opacity: 1.0
    camera:
      orbit: 0        # degrees (0=front, 90=right side, 180=back)
      elevation: 15    # degrees (0=eye level, 90=top down)
      distance: 5      # units from model
      fov: 50          # field of view degrees
      look_at: "model" # or {x, y, z} for fixed point
      offset:
        x: 0           # shift look-at horizontally
        y: 0           # shift look-at vertically
    easing: "easeInOutCubic"  # easing FROM previous keyframe to this one
    hold: false
    # Optional fields:
    # event:
    #   type: "split"
    #   pieces: ["top", "bottom", "ring"]
    #   spread: 3
    #   axis: "y"
    #   stagger: 0.1
    # responsive:
    #   tablet:
    #     position: {x: 70, y: 40, z: 1}
    #     scale: 0.8
    #   mobile:
    #     hidden: true
```

## Field Reference

### Units Convention
| Field | Unit | Range | Notes |
|-------|------|-------|-------|
| position.x | vw | 0-100 | 0=left edge, 50=center, 100=right |
| position.y | vh | 0-100 | 0=top, 50=center, 100=bottom |
| position.z | depth | any | positive=front, negative=behind content |
| rotation.* | degrees | any | converted to radians at implementation time |
| scale | multiplier | 0+ | 1.0 = original size |
| opacity | fraction | 0-1 | 0=invisible, 1=fully visible |
| orbit | degrees | 0-360 | 0=front, 90=right, 180=back, 270=left |
| elevation | degrees | -90 to 90 | 0=eye level, 90=top-down, -90=below |
| distance | units | 0+ | camera distance from model center |
| fov | degrees | 1-179 | field of view |
| scroll | normalized | 0-1 | 0=page top, 1=page bottom |
| height_vh | vh | 1+ | section scroll height (taller=slower scroll) |
| drag | fraction | 0-1 | scroll resistance |
| overshoot | fraction | 0-1 | spring overshoot amount |

### Required vs Optional Fields

**Always required:**
- `project`, `model.file`, `sections` (at least one), `keyframes` (at least one)
- Each keyframe: `scroll`, `section`, `model`, `camera`, `easing`
- Each section: `id`, `type`, `label`, `height_vh`

**Optional:**
- `model.initial_rotation` (defaults to 0,0,0)
- `physics` (defaults to momentum:true, drag:0.3, overshoot:0.1)
- `keyframe.hold` (defaults to false)
- `keyframe.event` (no event by default)
- `keyframe.responsive` (no responsive overrides by default)
- `keyframe.description` (empty string by default, but STRONGLY encouraged)
- `section.content_blocks` (empty array by default)

## Export Implementation

### Existing Exporter: `src/utils/yamlExporter.ts`
The `exportToYaml(project: SpynProject)` function already handles the basic
conversion. When modifying, follow these rules:

### Naming Convention
camelCase in TypeScript → snake_case in YAML:
- `initialScale` → `initial_scale`
- `initialRotation` → `initial_rotation`
- `contentBlocks` → `content_blocks`
- `heightVh` → `height_vh` (but stored as `height` in types, exported as `height_vh`)
- `zLayer` → `z_layer`
- `easeFrom` → `easing` (simplified name in export)
- `lookAt` → `look_at`
- `sectionId` → `section`

### Description Field
The `description` field on each keyframe is critical. It's the natural language
bridge that tells Claude Code what the designer intended:

```yaml
# Good descriptions:
description: "Model enters from left, rotated to show the back panel"
description: "Hold position while features content scrolls past"
description: "Exploded view — all parts spread out for detail inspection"

# Bad descriptions:
description: "keyframe 2"
description: ""
description: "moved right"
```

When exporting, warn if any keyframe has an empty description.

## Project Save/Load

### Save to LocalStorage
```typescript
function saveProject(project: SpynProject) {
  const json = JSON.stringify(project);
  localStorage.setItem(`spyn-project-${project.name}`, json);
}

function listSavedProjects(): string[] {
  return Object.keys(localStorage)
    .filter(k => k.startsWith('spyn-project-'))
    .map(k => k.replace('spyn-project-', ''));
}

function loadProject(name: string): SpynProject | null {
  const json = localStorage.getItem(`spyn-project-${name}`);
  return json ? JSON.parse(json) : null;
}
```

### Export as File Download
```typescript
function downloadYaml(yamlString: string, filename = 'spyn.config.yaml') {
  const blob = new Blob([yamlString], { type: 'text/yaml' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}
```

### Copy to Clipboard
```typescript
async function copyYamlToClipboard(yamlString: string): Promise<boolean> {
  try {
    await navigator.clipboard.writeText(yamlString);
    return true;
  } catch {
    return false;
  }
}
```

## Validation Rules

Before export, validate the project:

```typescript
interface ValidationError {
  field: string;
  message: string;
  severity: 'error' | 'warning';
}

function validateProject(project: SpynProject): ValidationError[] {
  const errors: ValidationError[] = [];

  // Required fields
  if (!project.model.file) {
    errors.push({ field: 'model.file', message: 'No model file specified', severity: 'error' });
  }
  if (project.sections.length === 0) {
    errors.push({ field: 'sections', message: 'At least one section required', severity: 'error' });
  }
  if (project.keyframes.length === 0) {
    errors.push({ field: 'keyframes', message: 'At least one keyframe required', severity: 'error' });
  }

  // Keyframe validation
  project.keyframes.forEach((kf, i) => {
    if (kf.scroll < 0 || kf.scroll > 1) {
      errors.push({ field: `keyframes[${i}].scroll`, message: `Scroll ${kf.scroll} out of 0-1 range`, severity: 'error' });
    }
    if (kf.model.opacity < 0 || kf.model.opacity > 1) {
      errors.push({ field: `keyframes[${i}].model.opacity`, message: 'Opacity must be 0-1', severity: 'error' });
    }
    if (kf.model.scale <= 0) {
      errors.push({ field: `keyframes[${i}].model.scale`, message: 'Scale must be positive', severity: 'error' });
    }
    if (!kf.description || kf.description.trim() === '') {
      errors.push({ field: `keyframes[${i}].description`, message: 'Empty description — Claude Code needs context', severity: 'warning' });
    }

    // Check section reference exists
    if (!project.sections.find(s => s.id === kf.sectionId)) {
      errors.push({ field: `keyframes[${i}].sectionId`, message: `References non-existent section ${kf.sectionId}`, severity: 'error' });
    }
  });

  // Physics validation
  if (project.physics.drag < 0 || project.physics.drag > 1) {
    errors.push({ field: 'physics.drag', message: 'Drag must be 0-1', severity: 'error' });
  }
  if (project.physics.overshoot < 0 || project.physics.overshoot > 1) {
    errors.push({ field: 'physics.overshoot', message: 'Overshoot must be 0-1', severity: 'error' });
  }

  return errors;
}
```

## Store Integration

```typescript
import { useStore } from '../../store';
import { exportToYaml } from '../../utils/yamlExporter';
import type { SpynProject } from '../../types';

function buildProject(): SpynProject {
  const state = useStore.getState();
  return {
    name: state.name,
    model: state.model,
    physics: state.physics,
    sections: state.sections,
    keyframes: state.keyframes,
  };
}

// Export workflow:
// 1. const project = buildProject();
// 2. const errors = validateProject(project);
// 3. if (errors.some(e => e.severity === 'error')) → show errors
// 4. const yaml = exportToYaml(project);
// 5. downloadYaml(yaml) or copyYamlToClipboard(yaml)
```

## Examples

**Example 1: Adding export button to the UI**
User says: "Add a button to export the YAML config"
Actions:
1. Add export button in a toolbar or menu area
2. On click: buildProject() → validateProject() → show warnings → exportToYaml() → download
3. Show validation errors/warnings in a toast or modal before downloading

**Example 2: Fixing export format**
User says: "The exported YAML uses camelCase instead of snake_case"
Actions:
1. Check yamlExporter.ts for any missed conversions
2. Ensure all nested objects follow snake_case convention
3. Verify with the field reference table above

## Troubleshooting

**Issue: YAML output has empty sections/keyframes arrays**
Cause: Building project from store when store is empty
Solution: Validate before export, show "nothing to export" message

**Issue: Descriptions not appearing in YAML**
Cause: Users forgot to fill in descriptions
Solution: Show warning during validation, highlight empty descriptions in UI

**Issue: File download doesn't trigger**
Cause: Browser blocking programmatic downloads
Solution: Ensure download is triggered from a user interaction (click handler),
not from an async callback
